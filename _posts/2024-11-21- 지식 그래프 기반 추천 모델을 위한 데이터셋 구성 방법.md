---
layout: post
title: "ì§€ì‹ ê·¸ë˜í”„ ê¸°ë°˜ ì¶”ì²œ ëª¨ë¸ì„ ìœ„í•œ ë°ì´í„°ì…‹ êµ¬ì„± ë°©ë²•"
date: 2024-11-21
typora-root-url: ../
image_style: "max-width:80%; display:block; margin:1em auto; border-radius:10px; box-shadow:0px 4px 8px rgba(0,0,0,0.8);"

---

# ì§€ì‹ ê·¸ë˜í”„ ê¸°ë°˜ ì¶”ì²œ ëª¨ë¸ì„ ìœ„í•œ ë°ì´í„°ì…‹ êµ¬ì„± ë°©ë²•

### ğŸ“„ ì„¤ëª…

Knowledge-aware í˜•ì‹ì˜ ëª¨ë¸ì„ ëŒë¦¬ê¸°ìœ„í•´ì„œëŠ”
.inter, .kg, .link í˜•ì‹ì˜ íŠ¹ë³„í•œ ë°ì´í„° êµ¬ì¡°ê°€ í•„ìš”í•©ë‹ˆë‹¤.
ë³€í™˜í•˜ëŠ” ê³¼ì •ì—ì„œ ê²ªì€ ë¬¸ì œì™€ í•´ê²° ë°©ë²•ì„ ê³µìœ í•©ë‹ˆë‹¤.

ê·¸ë‹ˆê¹Œ ìš”ì•½í•˜ìë©´ **ë°ì´í„°ì˜ .kg, .linkì˜ ë°ì´í„°ê°€ ì™œ ê·¸ë ‡ê²Œ êµ¬ì„±ë˜ì–´ ìˆëƒë©´ ì˜›ë‚  ë°ì´í„°ë¼ Wikidataê°€ ì•„ë‹ˆë¼ ì˜›ë‚  êµ¬ê¸€ì´ ì“°ë˜ Freebaseí˜•ì‹ìœ¼ë¡œ êµ¬ì„±ë˜ìˆë˜ ì‹œì ˆ ë°ì´í„°ë¼ ê·¸ëŸ¼. ë”°ë¡œ ì˜›ë‚  Freebaseí˜•ì‹ì— ë§ê²Œ ìˆ˜ì •ì´ í•„ìš”.**




### âœ… ì‘ì—…í•  ë‚´ìš©

- [x] ì§€ì‹ ê·¸ë˜í”„ì˜ íŠ¹ì„± ì´í•´
- [x] test.link, test.inter, test.kg ë“± ë² ì´ìŠ¤ ë°ì´í„°ì…‹ ë¶„ì„
- [x] Freebaseì™€ Wikidataì— ëŒ€í•œ ì´í•´, ì™œ ë°ì´í„°ì…‹ì´ Freebaseë°©ì‹ìœ¼ë¡œ ì‘ì„±ë˜ì–´ìˆëŠ”ì§€ ì˜ë¬¸ì  í•´ê²°
- [x] Freebase í˜•ì‹ìœ¼ë¡œ ë³€í™˜

```
import pandas as pd
import json
import os
from collections import defaultdict

def convert_to_freebase_format(input_dir, output_dir):
    """MovieLens ë°ì´í„°ë¥¼ Freebase í˜•ì‹ìœ¼ë¡œ ë³€í™˜"""
    os.makedirs(output_dir, exist_ok=True)
    print(f"ì…ë ¥ ë””ë ‰í† ë¦¬: {input_dir}")
    print(f"ì¶œë ¥ ë””ë ‰í† ë¦¬: {output_dir}")
    
    # Freebase ìŠ¤íƒ€ì¼ ID ìƒì„± í•¨ìˆ˜
    def create_fb_id(prefix, id_num):
        return f"m.{prefix}{id_num:06x}"  # 16ì§„ìˆ˜ 6ìë¦¬ë¡œ ë³€í™˜
    
    # 1. ID ë§¤í•‘ ìƒì„±
    ratings_df = pd.read_csv(os.path.join(input_dir, 'train_ratings.csv'))
    print(f"ratings ë°ì´í„° ë¡œë“œ ì™„ë£Œ: {len(ratings_df)} í–‰")
    
    # ê¸°ì¡´ IDë¥¼ Freebase ìŠ¤íƒ€ì¼ IDë¡œ ë§¤í•‘
    # int()ë¥¼ ì‚¬ìš©í•˜ì—¬ numpy.int64ë¥¼ Python intë¡œ ë³€í™˜
    item_to_fb = {int(item): create_fb_id('i', idx) 
                 for idx, item in enumerate(ratings_df['item'].unique())}
    user_to_fb = {int(user): int(idx) 
                 for idx, user in enumerate(ratings_df['user'].unique(), 1)}
    
    # 2. inter íŒŒì¼ ìƒì„±
    ratings_processed = pd.DataFrame({
        'user_id:token': ratings_df['user'].map(lambda x: user_to_fb[int(x)]),
        'item_id:token': ratings_df['item'].map(lambda x: int(x)),
        'rating:float': [1.0] * len(ratings_df),
        'timestamp:float': ratings_df['time']
    })
    
    # inter íŒŒì¼ ì €ì¥
    ratings_processed.to_csv(
        os.path.join(output_dir, 'movie.inter'),
        sep='\t',
        index=False
    )
    print("movie.inter íŒŒì¼ ì €ì¥ ì™„ë£Œ")
    
    # 3. Knowledge Graph (kg) ìƒì„±
    kg_triples = []
    
    # ê°ë… ì •ë³´ ì²˜ë¦¬
    directors_df = pd.read_csv(os.path.join(input_dir, 'directors.tsv'), sep='\t')
    for _, row in directors_df.iterrows():
        if int(row['item']) in item_to_fb:
            head = item_to_fb[int(row['item'])]
            relation = 'film.film.directed_by'
            tail = f"d.{row['director']}"
            kg_triples.append([head, relation, tail])
    print(f"ê°ë… ì •ë³´ ì²˜ë¦¬ ì™„ë£Œ: {len(directors_df)} í–‰")
    
    # ì¥ë¥´ ì •ë³´ ì²˜ë¦¬
    genres_df = pd.read_csv(os.path.join(input_dir, 'genres.tsv'), sep='\t')
    for _, row in genres_df.iterrows():
        if int(row['item']) in item_to_fb:
            head = item_to_fb[int(row['item'])]
            relation = 'film.film.genre'
            tail = f"g.{row['genre'].lower().replace(' ', '_')}"
            kg_triples.append([head, relation, tail])
    print(f"ì¥ë¥´ ì •ë³´ ì²˜ë¦¬ ì™„ë£Œ: {len(genres_df)} í–‰")
    
    # ì‘ê°€ ì •ë³´ ì²˜ë¦¬
    writers_df = pd.read_csv(os.path.join(input_dir, 'writers.tsv'), sep='\t')
    for _, row in writers_df.iterrows():
        if int(row['item']) in item_to_fb:
            head = item_to_fb[int(row['item'])]
            relation = 'film.film.writer'
            tail = f"w.{row['writer']}"
            kg_triples.append([head, relation, tail])
    print(f"ì‘ê°€ ì •ë³´ ì²˜ë¦¬ ì™„ë£Œ: {len(writers_df)} í–‰")
    
    # ì—°ë„ ì •ë³´ ì²˜ë¦¬
    years_df = pd.read_csv(os.path.join(input_dir, 'years.tsv'), sep='\t')
    for _, row in years_df.iterrows():
        if int(row['item']) in item_to_fb:
            head = item_to_fb[int(row['item'])]
            relation = 'film.film.year'
            tail = f"y.{row['year']}"
            kg_triples.append([head, relation, tail])
    print(f"ì—°ë„ ì •ë³´ ì²˜ë¦¬ ì™„ë£Œ: {len(years_df)} í–‰")
    
    # kg íŒŒì¼ ì €ì¥
    kg_df = pd.DataFrame(kg_triples, columns=['head_id:token', 'relation_id:token', 'tail_id:token'])
    kg_df.to_csv(os.path.join(output_dir, 'movie.kg'), sep='\t', index=False)
    print("movie.kg íŒŒì¼ ì €ì¥ ì™„ë£Œ")
    
    # 4. link íŒŒì¼ ìƒì„±
    link_data = [[int(item), fb_id] for item, fb_id in item_to_fb.items()]
    link_df = pd.DataFrame(link_data, columns=['item_id:token', 'entity_id:token'])
    link_df.to_csv(os.path.join(output_dir, 'movie.link'), sep='\t', index=False)
    print("movie.link íŒŒì¼ ì €ì¥ ì™„ë£Œ")
    
    # ë§¤í•‘ ì •ë³´ ì €ì¥ - int64ë¥¼ intë¡œ ë³€í™˜
    mappings = {
        'user_mapping': {int(k): int(v) for k, v in user_to_fb.items()},
        'item_mapping': {int(k): str(v) for k, v in item_to_fb.items()}  # Freebase IDëŠ” ë¬¸ìì—´ë¡œ ì €ì¥
    }
    
    with open(os.path.join(output_dir, 'mapping_info.json'), 'w') as f:
        json.dump(mappings, f, indent=2)
    
    return mappings

# ì‚¬ìš© ì˜ˆì‹œ
if __name__ == "__main__":
    input_directory = "data/train"
    output_directory = "recbole_data"
    
    try:
        mappings = convert_to_freebase_format(input_directory, output_directory)
        print("\n=== ë³€í™˜ ì™„ë£Œ ===")
        print(f"ì´ ì‚¬ìš©ì ìˆ˜: {len(mappings['user_mapping'])}")
        print(f"ì´ ì•„ì´í…œ ìˆ˜: {len(mappings['item_mapping'])}")
        
        # ê²°ê³¼ ìƒ˜í”Œ ì¶œë ¥
        print("\n=== ë³€í™˜ëœ ë°ì´í„° ìƒ˜í”Œ ===")
        for file_name in ['movie.inter', 'movie.kg', 'movie.link']:
            print(f"\n{file_name} ìƒ˜í”Œ:")
            df = pd.read_csv(os.path.join(output_directory, file_name), sep='\t', nrows=5)
            print(df)
            
    except Exception as e:
        print(f"\nì˜¤ë¥˜ ë°œìƒ: {str(e)}")
        import traceback
        print(traceback.format_exc())
```







