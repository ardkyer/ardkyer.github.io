---
layout: post
title: "ì‹¤ì‹œê°„ ê´‘ê³  ë°ì´í„° íŒŒì´í”„ë¼ì¸ êµ¬ì¶•ê¸° (1) - Kafka í™˜ê²½ ì„¸íŒ…ê³¼ ê´‘ê³  ë¡œê·¸ ìƒì„±ê¸°"
date: 2025-12-09
typora-root-url: ../
image_style: "max-width:80%; display:block; margin:1em auto; border-radius:10px; box-shadow:2px 2px 8px rgba(0,0,0,0.8);"
---

# ì‹¤ì‹œê°„ ê´‘ê³  ë°ì´í„° íŒŒì´í”„ë¼ì¸ êµ¬ì¶•ê¸° (1) - Kafka í™˜ê²½ ì„¸íŒ…ê³¼ ê´‘ê³  ë¡œê·¸ ìƒì„±ê¸°

> **8ì£¼ í”„ë¡œì íŠ¸ Day 1**: AdTech ë°ì´í„° ì—”ì§€ë‹ˆì–´ë¥¼ ìœ„í•œ ì‹¤ì „ í¬íŠ¸í´ë¦¬ì˜¤ ë§Œë“¤ê¸°

------

## í”„ë¡œì íŠ¸ ì†Œê°œ

### ë¬´ì—‡ì„ ë§Œë“œëŠ”ê°€?

**ì‹¤ì‹œê°„ ê´‘ê³  ì…ì°° ì‹œìŠ¤í…œ(RTB, Real-Time Bidding) ë°ì´í„° íŒŒì´í”„ë¼ì¸**ì„ ì²˜ìŒë¶€í„° ëê¹Œì§€ êµ¬ì¶•í•©ë‹ˆë‹¤.

```
[ê´‘ê³  ì´ë²¤íŠ¸ ë°œìƒ] 
    â†“
[Kafkaë¡œ ì‹¤ì‹œê°„ ìˆ˜ì§‘] 
    â†“
[Spark Streamingìœ¼ë¡œ ì§‘ê³„]
    â†“
[ClickHouseì— ì €ì¥]
    â†“
[Superset ëŒ€ì‹œë³´ë“œë¡œ ì‹œê°í™”]
    â†“
[ML ëª¨ë¸ë¡œ CTR ì˜ˆì¸¡]
```

### ì™œ ì´ í”„ë¡œì íŠ¸ì¸ê°€?

**AdTech(ê´‘ê³  ê¸°ìˆ ) ë¶„ì•¼**ëŠ” ë°ì´í„° ì—”ì§€ë‹ˆì–´ë§ì˜ ê½ƒì…ë‹ˆë‹¤:

- **ì‹¤ì‹œê°„ì„±**: ì´ˆë‹¹ ìˆ˜ë§Œ ê±´ì˜ ê´‘ê³  ìš”ì²­ ì²˜ë¦¬
- **ë¹„ì¦ˆë‹ˆìŠ¤ ì„íŒ©íŠ¸**: ìˆ˜ìµê³¼ ì§ê²°ë˜ëŠ” ì§€í‘œ (CTR, eCPM)
- **ê¸°ìˆ  ìŠ¤íƒ**: Kafka, Spark, ClickHouse ë“± ìµœì‹  ê¸°ìˆ 
- **ë³µì¡ë„**: ìŠ¤íŠ¸ë¦¬ë°, ë°°ì¹˜, ML ëª¨ë¸ ì„œë¹™ ëª¨ë‘ í¬í•¨

------

## ğŸ¯ Day 1 ëª©í‘œ

ì˜¤ëŠ˜ì€ **ë°ì´í„° íŒŒì´í”„ë¼ì¸ì˜ ì¶œë°œì **ì„ ë§Œë“­ë‹ˆë‹¤:

1. âœ… Dockerë¡œ Kafka í™˜ê²½ êµ¬ì¶•
2. âœ… ê´‘ê³  ë¡œê·¸ ìƒì„±ê¸° ê°œë°œ
3. âœ… ì‹¤ì‹œê°„ìœ¼ë¡œ Kafkaì— ì´ë²¤íŠ¸ ì „ì†¡
4. âœ… ë°ì´í„° êµ¬ì¡° ê²€ì¦

------

## ğŸ— Step 1: í”„ë¡œì íŠ¸ êµ¬ì¡° ì„¤ê³„

### GitHub Repository êµ¬ì¡°

```
adtech-realtime-pipeline/
â”‚
â”œâ”€â”€ README.md                    # í”„ë¡œì íŠ¸ ì„¤ëª…
â”œâ”€â”€ docker-compose.yml           # ì¸í”„ë¼ ì„¤ì •
â”œâ”€â”€ requirements.txt             # Python íŒ¨í‚¤ì§€
â”‚
â”œâ”€â”€ data-generator/              # ê´‘ê³  ë¡œê·¸ ìƒì„±ê¸°
â”‚   â”œâ”€â”€ ad_log_generator.py     # Producer
â”‚   â””â”€â”€ ad_log_consumer.py      # Consumer
â”‚
â”œâ”€â”€ streaming/                   # Spark Streaming (Day 2)
â”œâ”€â”€ models/                      # ML ëª¨ë¸ (Day 5)
â”œâ”€â”€ sql/                         # ClickHouse ìŠ¤í‚¤ë§ˆ
â””â”€â”€ docs/                        # ë¬¸ì„œ
```

### ì™œ ì´ë ‡ê²Œ êµ¬ì„±í–ˆë‚˜?

- **ëª¨ë“ˆí™”**: ê° ê¸°ëŠ¥ì„ ë…ë¦½ì ìœ¼ë¡œ ê°œë°œ/í…ŒìŠ¤íŠ¸ ê°€ëŠ¥
- **í™•ì¥ì„±**: ìƒˆë¡œìš´ ê¸°ëŠ¥ ì¶”ê°€ ì‹œ êµ¬ì¡° ë³€ê²½ ë¶ˆí•„ìš”
- **ê°€ë…ì„±**: ë””ë ‰í† ë¦¬ë§Œ ë´ë„ í”„ë¡œì íŠ¸ êµ¬ì¡° íŒŒì•… ê°€ëŠ¥

------

## ğŸ³ Step 2: Docker Composeë¡œ ì¸í”„ë¼ êµ¬ì¶•

### ì™œ Dockerì¸ê°€?

ì‹¤ë¬´ì—ì„œëŠ” Kafka, ClickHouse, Redis ë“±ì„ ê°ê° ì„¤ì¹˜í•˜ê³  ì„¤ì •í•˜ëŠ” ê²Œ ë³µì¡í•©ë‹ˆë‹¤. Docker Composeë¥¼ ì‚¬ìš©í•˜ë©´:

- **ì¼ê´€ëœ í™˜ê²½**: ëª¨ë“  íŒ€ì›ì´ ë™ì¼í•œ í™˜ê²½ì—ì„œ ì‘ì—…
- **ë¹ ë¥¸ ì…‹ì—…**: `docker-compose up` í•œ ì¤„ë¡œ ì „ì²´ ì¸í”„ë¼ ì‹¤í–‰
- **ê²©ë¦¬**: ë¡œì»¬ í™˜ê²½ ì˜¤ì—¼ ì—†ì´ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥

### docker-compose.yml í•µì‹¬ êµ¬ì„±

```yaml
services:
  # Kafkaë¥¼ ìœ„í•œ Zookeeper
  zookeeper:
    image: confluentinc/cp-zookeeper:7.4.0
    environment:
      ZOOKEEPER_CLIENT_PORT: 2181

  # Kafka ë¸Œë¡œì»¤
  kafka:
    image: confluentinc/cp-kafka:7.4.0
    depends_on:
      - zookeeper
    ports:
      - "9092:9092"
    environment:
      KAFKA_BROKER_ID: 1
      KAFKA_ZOOKEEPER_CONNECT: zookeeper:2181
      KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://localhost:9092

  # ClickHouse (OLAP ë°ì´í„°ë² ì´ìŠ¤)
  clickhouse:
    image: clickhouse/clickhouse-server:23.8
    ports:
      - "8123:8123"  # HTTP API
      - "9000:9000"  # Native protocol

  # Redis (ìºì‹±ìš©)
  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"

  # Superset (ëŒ€ì‹œë³´ë“œ)
  superset:
    image: apache/superset:2.1.0
    ports:
      - "8088:8088"
```

### ê° ì»´í¬ë„ŒíŠ¸ì˜ ì—­í• 

| ì»´í¬ë„ŒíŠ¸       | ì—­í•        | ì™œ í•„ìš”í•œê°€?                    |
| -------------- | ---------- | ------------------------------- |
| **Kafka**      | ë©”ì‹œì§€ í  | ì‹¤ì‹œê°„ ì´ë²¤íŠ¸ ìŠ¤íŠ¸ë¦¬ë°          |
| **Zookeeper**  | Kafka ê´€ë¦¬ | Kafka í´ëŸ¬ìŠ¤í„° ì½”ë””ë„¤ì´ì…˜       |
| **ClickHouse** | OLAP DB    | ë¹ ë¥¸ ì§‘ê³„ ì¿¼ë¦¬ (ì»¬ëŸ¼ ê¸°ë°˜ ì €ì¥) |
| **Redis**      | ìºì‹œ       | ML ëª¨ë¸ ì˜ˆì¸¡ ê²°ê³¼ ì €ì¥          |
| **Superset**   | BI ë„êµ¬    | ì‹¤ì‹œê°„ ëŒ€ì‹œë³´ë“œ                 |

### ì‹¤í–‰

```bash
# ì „ì²´ ì¸í”„ë¼ ì‹œì‘
docker-compose up -d

# ìƒíƒœ í™•ì¸
docker-compose ps

# ì¶œë ¥:
# NAME                IMAGE                               STATUS
# adtech-kafka        confluentinc/cp-kafka:7.4.0        Up
# adtech-clickhouse   clickhouse/clickhouse-server:23.8  Up
# adtech-redis        redis:7-alpine                     Up
# adtech-superset     apache/superset:2.1.0              Up
# adtech-zookeeper    confluentinc/cp-zookeeper:7.4.0    Up
```

------

## ğŸ“Š Step 3: ê´‘ê³  ë°ì´í„° êµ¬ì¡° ì„¤ê³„

### ì‹¤ì œ ê´‘ê³  ë¡œê·¸ëŠ” ì–´ë–»ê²Œ ìƒê²¼ë‚˜?

ê´‘ê³  ì‹œìŠ¤í…œì—ì„œëŠ” ë‘ ê°€ì§€ í•µì‹¬ ì´ë²¤íŠ¸ê°€ ë°œìƒí•©ë‹ˆë‹¤:

1. **Impression (ë…¸ì¶œ)**: ì‚¬ìš©ìê°€ ê´‘ê³ ë¥¼ ë´„
2. **Click (í´ë¦­)**: ì‚¬ìš©ìê°€ ê´‘ê³ ë¥¼ í´ë¦­í•¨

### ìš°ë¦¬ì˜ ì´ë²¤íŠ¸ ìŠ¤í‚¤ë§ˆ

```json
{
  "event_id": "E1765295181994871",
  "timestamp": "2025-12-10T00:46:21.994570",
  "user_id": "U60734",
  "campaign_id": "C003",
  "ad_format": "interstitial",
  "country": "US",
  "device": "Android",
  "event_type": "impression",
  "revenue": 0.0
}
```

### í•„ë“œ ì„¤ëª…

| í•„ë“œ          | íƒ€ì…       | ì„¤ëª…                                             |
| ------------- | ---------- | ------------------------------------------------ |
| `event_id`    | String     | ê³ ìœ  ì´ë²¤íŠ¸ ID                                   |
| `timestamp`   | ISO String | ì´ë²¤íŠ¸ ë°œìƒ ì‹œê°                                 |
| `user_id`     | String     | ì‚¬ìš©ì ì‹ë³„ì                                    |
| `campaign_id` | String     | ê´‘ê³  ìº í˜ì¸ ID                                   |
| `ad_format`   | String     | ê´‘ê³  í¬ë§· (banner, interstitial, rewarded_video) |
| `country`     | String     | ì‚¬ìš©ì êµ­ê°€ (US, KR, JP ë“±)                      |
| `device`      | String     | ë””ë°”ì´ìŠ¤ (iOS, Android)                          |
| `event_type`  | String     | ì´ë²¤íŠ¸ íƒ€ì… (impression, click)                  |
| `revenue`     | Float      | ìˆ˜ìµ (í´ë¦­ ì‹œì—ë§Œ ë°œìƒ)                          |

### ì™œ ì´ë ‡ê²Œ ì„¤ê³„í–ˆë‚˜?

**1. ì‹¤ë¬´ì™€ ë™ì¼í•œ êµ¬ì¡°**

- ì‹¤ì œ AdTech íšŒì‚¬ë“¤ì´ ì‚¬ìš©í•˜ëŠ” í•„ë“œë“¤
- ë¶„ì„ì— í•„ìš”í•œ ìµœì†Œí•œì˜ ì •ë³´

**2. í™•ì¥ ê°€ëŠ¥ì„±**

- ë‚˜ì¤‘ì— í•„ë“œ ì¶”ê°€ ê°€ëŠ¥ (ì˜ˆ: `ad_size`, `placement_id`)
- JSON í˜•íƒœë¼ ìŠ¤í‚¤ë§ˆ ë³€ê²½ ìœ ì—°

**3. ë¶„ì„ ìš©ì´ì„±**

- êµ­ê°€ë³„, í¬ë§·ë³„, ìº í˜ì¸ë³„ ì§‘ê³„ ê°€ëŠ¥
- íƒ€ì„ìŠ¤íƒ¬í”„ë¡œ ì‹œê³„ì—´ ë¶„ì„ ê°€ëŠ¥

------

## ğŸ’¡ Step 4: í˜„ì‹¤ì ì¸ ë°ì´í„° ì‹œë®¬ë ˆì´ì…˜

### ê´‘ê³  ì§€í‘œ ì´í•´í•˜ê¸°

**CTR (Click-Through Rate)**: í´ë¦­ë¥ 

```
CTR = (í´ë¦­ ìˆ˜ / ë…¸ì¶œ ìˆ˜) Ã— 100%
```

**eCPM (effective Cost Per Mille)**: 1,000íšŒ ë…¸ì¶œë‹¹ ìˆ˜ìµ

```
eCPM = (ì´ ìˆ˜ìµ / ì´ ë…¸ì¶œ ìˆ˜) Ã— 1,000
```

### ì‹¤ì œ ì—…ê³„ ë°ì´í„° ë°˜ì˜

#### 1. ê´‘ê³  í¬ë§·ë³„ CTR

```python
FORMAT_CTR = {
    'banner': 0.05,          # 5% - ë°°ë„ˆ ê´‘ê³ ëŠ” ë‚®ìŒ
    'interstitial': 0.12,    # 12% - ì „ë©´ ê´‘ê³ ëŠ” ì¤‘ê°„
    'rewarded_video': 0.25   # 25% - ë¦¬ì›Œë“œ ê´‘ê³ ëŠ” ë†’ìŒ
}
```

**ì™œ ì´ëŸ° ì°¨ì´ê°€?**

- ë°°ë„ˆ: ì‘ê³  ëˆˆì— ì•ˆ ë”
- ì „ë©´: í¬ê³  ê°•ì œ ë…¸ì¶œ
- ë¦¬ì›Œë“œ: ì‚¬ìš©ìê°€ ë³´ìƒ ë°›ê¸° ìœ„í•´ ìë°œì  ì‹œì²­

#### 2. êµ­ê°€ë³„ eCPM

```python
COUNTRY_ECPM = {
    'US': (0.02, 0.10),   # ë¯¸êµ­: $0.02~$0.10
    'KR': (0.01, 0.05),   # í•œêµ­: $0.01~$0.05
    'JP': (0.015, 0.08),  # ì¼ë³¸: $0.015~$0.08
}
```

**ì™œ ë¯¸êµ­ì´ ì œì¼ ë†’ë‚˜?**

- ê´‘ê³ ì£¼ ê²½ìŸì´ ì¹˜ì—´í•¨
- êµ¬ë§¤ë ¥ì´ ë†’ìŒ
- ê´‘ê³  ì‹œì¥ì´ ì„±ìˆ™í•¨

------

## ğŸ”§ Step 5: ê´‘ê³  ë¡œê·¸ ìƒì„±ê¸° êµ¬í˜„

### confluent-kafkaë¥¼ ì„ íƒí•œ ì´ìœ 

**kafka-pythonì˜ ë¬¸ì œì :**

- Python 3.12ì™€ í˜¸í™˜ì„± ì´ìŠˆ
- ìœ ì§€ë³´ìˆ˜ê°€ ê±°ì˜ ì•ˆ ë¨
- ì„±ëŠ¥ì´ ìƒëŒ€ì ìœ¼ë¡œ ëŠë¦¼

**confluent-kafkaì˜ ì¥ì :**

- Confluent ê³µì‹ ì§€ì› (Kafka ê°œë°œì‚¬)
- C ë¼ì´ë¸ŒëŸ¬ë¦¬ ê¸°ë°˜ìœ¼ë¡œ ë¹ ë¦„
- Python 3.12 ì™„ë²½ ì§€ì›

### ì½”ë“œ í•µì‹¬ ë¡œì§

```python
from confluent_kafka import Producer
import json
import random
from datetime import datetime
from faker import Faker

fake = Faker()

# Kafka Producer ì„¤ì •
conf = {'bootstrap.servers': 'localhost:9092'}
producer = Producer(conf)

def generate_ad_event():
    """ê´‘ê³  ì´ë²¤íŠ¸ í•˜ë‚˜ ìƒì„±"""
    
    # ê´‘ê³  í¬ë§· ì„ íƒ
    ad_format = random.choice(['banner', 'interstitial', 'rewarded_video'])
    
    # í•´ë‹¹ í¬ë§·ì˜ CTR ê¸°ë°˜ìœ¼ë¡œ í´ë¦­ ì—¬ë¶€ ê²°ì •
    ctr = FORMAT_CTR[ad_format]
    is_click = random.random() < ctr
    
    # í´ë¦­ì´ë©´ ìˆ˜ìµ ë°œìƒ
    revenue = 0
    if is_click:
        country = random.choice(['US', 'KR', 'JP', ...])
        ecpm_range = COUNTRY_ECPM[country]
        revenue = round(random.uniform(*ecpm_range), 4)
    
    return {
        'event_id': f"E{int(time.time()*1000)}{random.randint(100,999)}",
        'timestamp': datetime.now().isoformat(),
        'user_id': f"U{fake.random_int(min=10000, max=99999)}",
        'campaign_id': random.choice(['C001', 'C002', ...]),
        'ad_format': ad_format,
        'country': country,
        'device': random.choice(['iOS', 'Android']),
        'event_type': 'click' if is_click else 'impression',
        'revenue': revenue
    }
```

### í•µì‹¬ í¬ì¸íŠ¸

**1. í™•ë¥  ê¸°ë°˜ í´ë¦­ ìƒì„±**

```python
is_click = random.random() < ctr
```

- `random.random()`ì€ 0~1 ì‚¬ì´ ê°’ ë°˜í™˜
- CTRì´ 0.05ë©´ 5% í™•ë¥ ë¡œ í´ë¦­ ë°œìƒ

**2. Kafka ë¹„ë™ê¸° ì „ì†¡**

```python
producer.produce(
    'ad-events',
    key=event['event_id'].encode('utf-8'),
    value=json.dumps(event).encode('utf-8')
)
producer.poll(0)  # ë¹„ë™ê¸° ì²˜ë¦¬
```

- `poll(0)`: ë°±ê·¸ë¼ìš´ë“œ ì „ì†¡ ì²˜ë¦¬
- ì„±ëŠ¥ì„ ìœ„í•´ ë²„í¼ì— ëª¨ì•„ì„œ ì „ì†¡

**3. ì£¼ê¸°ì ì¸ Flush**

```python
if event_count % 1000 == 0:
    producer.flush()  # ë²„í¼ ê°•ì œ ë¹„ìš°ê¸°
```

- 1,000ê°œë§ˆë‹¤ í™•ì‹¤í•˜ê²Œ ì „ì†¡
- ë°ì´í„° ì†ì‹¤ ë°©ì§€

------

## ğŸš€ Step 6: Kafka í† í”½ ìƒì„± ë° í…ŒìŠ¤íŠ¸

### Kafka Topicì´ë€?

ì¹´í”„ì¹´ì˜ **í† í”½(Topic)**ì€ ë©”ì‹œì§€ë¥¼ ì €ì¥í•˜ëŠ” ë…¼ë¦¬ì  ì±„ë„ì…ë‹ˆë‹¤.

- ê²Œì‹œíŒì˜ "ì¹´í…Œê³ ë¦¬"ì™€ ë¹„ìŠ·
- ì—¬ëŸ¬ Producerê°€ ê°™ì€ í† í”½ì— ë©”ì‹œì§€ ì „ì†¡ ê°€ëŠ¥
- ì—¬ëŸ¬ Consumerê°€ ê°™ì€ í† í”½ì—ì„œ ë©”ì‹œì§€ ì½ê¸° ê°€ëŠ¥

### í† í”½ ìƒì„±

```bash
docker exec adtech-kafka kafka-topics \
  --create \
  --topic ad-events \
  --bootstrap-server localhost:9092 \
  --partitions 3 \
  --replication-factor 1
```

**íŒŒë¼ë¯¸í„° ì„¤ëª…:**

- `--partitions 3`: 3ê°œì˜ íŒŒí‹°ì…˜ìœ¼ë¡œ ë¶„ì‚° (ë³‘ë ¬ ì²˜ë¦¬)
- `--replication-factor 1`: ë³µì œë³¸ 1ê°œ (ë¡œì»¬ í™˜ê²½ì´ë¼ 1ê°œ)

### ìƒì„±ê¸° ì‹¤í–‰

```bash
python data-generator/ad_log_generator.py
```

**ì¶œë ¥:**

```
ğŸš€ Starting Ad Log Generator...
ğŸ“Š Generating ~100 events/sec
ğŸ“ Kafka Topic: ad-events
==================================================
âœ… Sent 1,000 events | Rate: 82.9 events/sec
âœ… Sent 2,000 events | Rate: 82.7 events/sec
```

### ë°ì´í„° í™•ì¸

```bash
docker exec -it adtech-kafka kafka-console-consumer \
  --bootstrap-server localhost:9092 \
  --topic ad-events \
  --from-beginning \
  --max-messages 3
```

**ì¶œë ¥:**

```json
{"event_id": "E1765295181994871", "timestamp": "2025-12-10T00:46:21.994570", "user_id": "U60734", "campaign_id": "C003", "ad_format": "interstitial", "country": "US", "device": "Android", "event_type": "impression", "revenue": 0}

{"event_id": "E1765295182007140", "timestamp": "2025-12-10T00:46:22.007029", "user_id": "U73756", "campaign_id": "C004", "ad_format": "banner", "country": "FR", "device": "Android", "event_type": "impression", "revenue": 0}

{"event_id": "E1765295182042305", "timestamp": "2025-12-10T00:46:22.042544", "user_id": "U21745", "campaign_id": "C004", "ad_format": "banner", "country": "KR", "device": "iOS", "event_type": "impression", "revenue": 0}
```

------

## ğŸ“ˆ Step 7: ì„±ê³¼ ì¸¡ì •

### ì˜¤ëŠ˜ ìƒì„±í•œ ë°ì´í„°

```
ğŸ“Š Final Stats:
   - Total Events: 2,937
   - Duration: 35.5s
   - Avg Rate: 82.6 events/sec
```

### ë°ì´í„° ë¶„í¬ ë¶„ì„ (ì˜ˆìƒ)

**ì´ë²¤íŠ¸ íƒ€ì… ë¶„í¬:**

- Impression: ~2,650ê±´ (90%)
- Click: ~287ê±´ (10%)

**êµ­ê°€ ë¶„í¬ (ê· ë“± ëœë¤):**

- US, KR, JP, UK, DE, FR, CA ê°ê° ~420ê±´

**ê´‘ê³  í¬ë§· ë¶„í¬ (ê· ë“± ëœë¤):**

- Banner: ~979ê±´
- Interstitial: ~979ê±´
- Rewarded Video: ~979ê±´

**í‰ê·  CTR:**

- ì „ì²´: ~10%
- Banner: ~5%
- Interstitial: ~12%
- Rewarded Video: ~25%

------

## ğŸ“ ë°°ìš´ ê²ƒë“¤

### 1. Kafka ê¸°ì´ˆ ê°œë…

**Producer â†’ Topic â†’ Consumer êµ¬ì¡°**

```
[Producer]  â”€â”€â”€â”€â”€>  [Topic: ad-events]  â”€â”€â”€â”€â”€>  [Consumer]
(ê´‘ê³  ë¡œê·¸ ìƒì„±)        (ë©”ì‹œì§€ ì €ì¥)          (ë°ì´í„° ì²˜ë¦¬)
```

### 2. ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¬ë°ì˜ í•µì‹¬

- **ë¹„ë™ê¸° ì²˜ë¦¬**: ë¸”ë¡œí‚¹ ì—†ì´ ë¹ ë¥´ê²Œ ì „ì†¡
- **ë°°ì¹˜ ì „ì†¡**: ê°œë³„ ì „ì†¡ë³´ë‹¤ ë¬¶ì–´ì„œ ì „ì†¡ì´ íš¨ìœ¨ì 
- **ë°±í”„ë ˆì…”**: Producerê°€ ë„ˆë¬´ ë¹ ë¥´ë©´ ë²„í¼ ê´€ë¦¬ í•„ìš”

### 3. AdTech ë„ë©”ì¸ ì§€ì‹

- **CTR**: ê´‘ê³  íš¨ìœ¨ì„± ì§€í‘œ
- **eCPM**: ìˆ˜ìµì„± ì§€í‘œ
- **Fill Rate**: ê´‘ê³  ì±„ì›€ë¥  (ë‹¤ìŒ ë‹¨ê³„ì—ì„œ ë‹¤ë£° ì˜ˆì •)

------

## ğŸ› íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### ë¬¸ì œ 1: kafka-python í˜¸í™˜ì„± ì—ëŸ¬

**ì¦ìƒ:**

```
ModuleNotFoundError: No module named 'kafka.vendor.six.moves'
```

**ì›ì¸:**

- Python 3.12ì—ì„œ kafka-python ë¼ì´ë¸ŒëŸ¬ë¦¬ ì˜¤ë˜ë¨

**í•´ê²°:**

```bash
pip uninstall kafka-python
pip install confluent-kafka
```

### ë¬¸ì œ 2: Docker ë°ëª¬ ë¯¸ì‹¤í–‰

**ì¦ìƒ:**

```
Cannot connect to the Docker daemon
```

**í•´ê²°:**

```bash
# Docker Desktop ì‹¤í–‰
open -a Docker

# 30ì´ˆ ëŒ€ê¸° í›„
docker ps  # ì •ìƒ ì‘ë™ í™•ì¸
```

### ë¬¸ì œ 3: í¬íŠ¸ ì¶©ëŒ

**ì¦ìƒ:**

```
port 8080 already in use
```

**í•´ê²°:**

```bash
# ì‚¬ìš© ì¤‘ì¸ í”„ë¡œì„¸ìŠ¤ í™•ì¸
lsof -i :8080

# ê¸°ì¡´ ì»¨í…Œì´ë„ˆ ì¤‘ì§€ ë˜ëŠ”
# docker-compose.ymlì—ì„œ í¬íŠ¸ ë³€ê²½
ports:
  - "8089:8088"  # 8088 â†’ 8089
```

------

## ğŸ“¦ ì™„ì„±ëœ êµ¬ì¡°

```
adtech-realtime-pipeline/
â”‚
â”œâ”€â”€ docker-compose.yml          # âœ… 5ê°œ ì„œë¹„ìŠ¤ ì‹¤í–‰ ì¤‘
â”œâ”€â”€ requirements.txt            # âœ… confluent-kafka, faker
â”‚
â”œâ”€â”€ data-generator/
â”‚   â”œâ”€â”€ ad_log_generator.py    # âœ… 83 events/sec
â”‚   â””â”€â”€ ad_log_consumer.py     # ì¤€ë¹„ ì™„ë£Œ
â”‚
â”œâ”€â”€ .gitignore                 # âœ… data/, *.jsonl ì œì™¸
â””â”€â”€ README.md                  # âœ… í”„ë¡œì íŠ¸ ë¬¸ì„œ
```

------

## ğŸ¯ ë‹¤ìŒ ë‹¨ê³„ (Day 2-3)

### ëª©í‘œ: Spark Streamingìœ¼ë¡œ ì‹¤ì‹œê°„ ì§‘ê³„

**í•  ì¼:**

1. PySpark ì„¤ì¹˜ ë° í™˜ê²½ êµ¬ì¶•
2. Kafkaì—ì„œ ìŠ¤íŠ¸ë¦¼ ì½ê¸°
3. 10ì´ˆ ìœˆë„ìš°ë¡œ ì§‘ê³„
4. CTR, eCPM ì‹¤ì‹œê°„ ê³„ì‚°
5. ì½˜ì†”ì— ê²°ê³¼ ì¶œë ¥

**ì˜ˆìƒ ê²°ê³¼:**

```
Window: 2025-12-10 00:46:00 ~ 00:46:10
Campaign: C001 | Format: banner
- Impressions: 85
- Clicks: 4
- CTR: 4.7%
- Revenue: $0.23
- eCPM: $2.71
```

------

## ğŸ’» ì „ì²´ ì½”ë“œ

### ìµœì¢… ad_log_generator.py

```python
from confluent_kafka import Producer
import json
import random
import time
from datetime import datetime
from faker import Faker

fake = Faker()

conf = {'bootstrap.servers': 'localhost:9092'}
producer = Producer(conf)

CAMPAIGNS = ['C001', 'C002', 'C003', 'C004', 'C005']
AD_FORMATS = ['banner', 'interstitial', 'rewarded_video']
COUNTRIES = ['US', 'KR', 'JP', 'UK', 'DE', 'FR', 'CA']
DEVICES = ['iOS', 'Android']

COUNTRY_ECPM = {
    'US': (0.02, 0.10),
    'KR': (0.01, 0.05),
    'JP': (0.015, 0.08),
    'UK': (0.015, 0.07),
    'DE': (0.01, 0.06),
    'FR': (0.01, 0.05),
    'CA': (0.015, 0.07)
}

FORMAT_CTR = {
    'banner': 0.05,
    'interstitial': 0.12,
    'rewarded_video': 0.25
}

def delivery_report(err, msg):
    if err is not None:
        print(f'âŒ Message delivery failed: {err}')

def generate_ad_event():
    timestamp = datetime.now().isoformat()
    user_id = f"U{fake.random_int(min=10000, max=99999)}"
    campaign_id = random.choice(CAMPAIGNS)
    ad_format = random.choice(AD_FORMATS)
    country = random.choice(COUNTRIES)
    device = random.choice(DEVICES)
    
    ctr = FORMAT_CTR[ad_format]
    is_click = random.random() < ctr
    event_type = 'click' if is_click else 'impression'
    
    revenue = 0
    if is_click:
        ecpm_range = COUNTRY_ECPM[country]
        revenue = round(random.uniform(*ecpm_range), 4)
    
    return {
        'event_id': f"E{int(time.time()*1000)}{random.randint(100,999)}",
        'timestamp': timestamp,
        'user_id': user_id,
        'campaign_id': campaign_id,
        'ad_format': ad_format,
        'country': country,
        'device': device,
        'event_type': event_type,
        'revenue': revenue
    }

def main():
    print("ğŸš€ Starting Ad Log Generator...")
    print("ğŸ“Š Generating ~100 events/sec")
    print("ğŸ“ Kafka Topic: ad-events")
    print("=" * 50)
    
    event_count = 0
    start_time = time.time()
    
    try:
        while True:
            event = generate_ad_event()
            
            producer.produce(
                'ad-events',
                key=event['event_id'].encode('utf-8'),
                value=json.dumps(event).encode('utf-8'),
                callback=delivery_report
            )
            producer.poll(0)
            
            event_count += 1
            
            if event_count % 1000 == 0:
                producer.flush()
                elapsed = time.time() - start_time
                rate = event_count / elapsed
                print(f"âœ… Sent {event_count:,} events | Rate: {rate:.1f} events/sec")
            
            time.sleep(0.01)
            
    except KeyboardInterrupt:
        print("\n\nğŸ›‘ Stopping generator...")
        producer.flush()
        elapsed = time.time() - start_time
        print(f"ğŸ“Š Final Stats:")
        print(f"   - Total Events: {event_count:,}")
        print(f"   - Duration: {elapsed:.1f}s")
        print(f"   - Avg Rate: {event_count/elapsed:.1f} events/sec")

if __name__ == "__main__":
    main()
```

------

## ğŸ“š ì°¸ê³  ìë£Œ

### Kafka ê³µì‹ ë¬¸ì„œ

- [Apache Kafka Introduction](https://kafka.apache.org/intro)
- [Confluent Kafka Python](https://docs.confluent.io/kafka-clients/python/current/overview.html)

### AdTech ê°œë…

- [What is RTB (Real-Time Bidding)?](https://www.applovin.com/blog/what-is-real-time-bidding/)
- [Understanding eCPM](https://www.ironsource.com/resources/glossary/ecpm/)

### Docker Compose

- [Docker Compose Documentation](https://docs.docker.com/compose/)

------

## ğŸ‰ ë§ˆë¬´ë¦¬

ì˜¤ëŠ˜ ìš°ë¦¬ëŠ”:

- âœ… Kafka ê¸°ë°˜ ì‹¤ì‹œê°„ ë°ì´í„° íŒŒì´í”„ë¼ì¸ ê¸°ì´ˆ êµ¬ì¶•
- âœ… í˜„ì‹¤ì ì¸ ê´‘ê³  ë°ì´í„° ì‹œë®¬ë ˆì´ì…˜
- âœ… ì´ˆë‹¹ 83ê°œ ì´ë²¤íŠ¸ë¥¼ ì•ˆì •ì ìœ¼ë¡œ ìƒì„±

**8ì£¼ í”„ë¡œì íŠ¸ Day 1 ì™„ë£Œ!**

ë‹¤ìŒ í¬ìŠ¤íŒ…ì—ì„œëŠ” Spark Streamingìœ¼ë¡œ ì‹¤ì‹œê°„ ì§‘ê³„ë¥¼ êµ¬í˜„í•©ë‹ˆë‹¤.

------

**GitHub Repository**: [adtech-realtime-pipeline](https://github.com/yourusername/adtech-realtime-pipeline)

**ë‹¤ìŒ ê¸€**: [ì‹¤ì‹œê°„ ê´‘ê³  ë°ì´í„° íŒŒì´í”„ë¼ì¸ êµ¬ì¶•ê¸° (2) - Spark Streaming ì‹¤ì‹œê°„ ì§‘ê³„](#)

------

*ì´ ê¸€ì´ ë„ì›€ì´ ë˜ì—ˆë‹¤ë©´ â­ï¸ ìŠ¤íƒ€ì™€ ğŸ‘ ê³µìœ  ë¶€íƒë“œë¦½ë‹ˆë‹¤!*



